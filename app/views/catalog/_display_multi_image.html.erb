<% cache("display_multi_image_#{params[:collection]}_#{params[:id]}", expires_in: 7.days) do %>

  <%# default partial to display solr document fields in catalog show view -%>

  <%# --------------------------- %>
  <%#   Multi-Page / Multi-Image  %>
  <%# --------------------------- %>

  <% if is_multi_image?(@document) %>

    <%# For search engine indexing & graceful degradation, %>
    <%# show the first image in <img> and make links to the rest %>   
    <noscript>          
      <%= render partial: "show_image_derivative", locals: { image_path: @document_multires_image_file_paths.first } %> 

      <h3>Images for this Item</h3>
      <ul>
        <% @document_multires_image_file_paths.each do |path| %>
          <% unless path.blank? %>
            <li><%= link_to File.basename(path, File.extname(path)), iiif_image_path(path, {:size => '!850,850'}) %></li>
          <% end %>
        <% end %>
      </ul>
    </noscript>
    
    <%# Make the array of page image paths accessible to JS for use by the download buttons %>
    <%= javascript_tag do %>
      var pagepaths = <%= raw @document_multires_image_file_paths.to_json %>;
    <% end %>
    
  <% end %>

  <%# ------------------------------------ %>
  <%#   Multi-Res (Has One or More PTIFs)  %>
  <%# ------------------------------------ %>

  <% if tilesources = image_item_tilesources(@document_multires_image_file_paths) %>
    
    <%= render partial: "show_multires_image_download", locals: { image_path: @document_multires_image_file_paths.first, imagecount: tilesources.length } %>  
    <%= render partial: "show_seadragon", locals: { aspectratio: image_item_aspectratio(@document_multires_image_file_paths), imagecount: tilesources.length } %>

  <% end %>

  <%= render partial: "show_default", locals: {document: document} %>

<% end %>
